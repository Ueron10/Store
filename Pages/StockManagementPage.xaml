<?xml version="1.0" encoding="utf-8" ?>
<ContentPage x:Class="StoreProgram.Pages.StockManagementPage"
             xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             Title="Manajemen Stok">
    
    <Grid RowDefinitions="Auto,*">
        <!-- Add Product Popup Overlay -->
        <Grid x:Name="AddProductOverlay"
              Grid.RowSpan="2"
              IsVisible="False"
              BackgroundColor="#66000000"
              Padding="20"
              ZIndex="100">
            <Grid.GestureRecognizers>
                <!-- Tap backdrop to close -->
                <TapGestureRecognizer Tapped="OnAddProductOverlayBackgroundTapped" />
            </Grid.GestureRecognizers>
            <Frame BackgroundColor="{StaticResource CardBackground}"
                   CornerRadius="15"
                   Padding="20"
                   HasShadow="True"
                   VerticalOptions="Center"
                   HorizontalOptions="Center"
                   WidthRequest="420">
                <StackLayout Spacing="12">
                    <Grid ColumnDefinitions="*,Auto">
                        <Label Text="âž• Tambah Produk"
                               FontSize="18"
                               FontAttributes="Bold"
                               TextColor="{StaticResource Gray900}"/>
                        <Button Grid.Column="1"
                                Text="âœ•"
                                BackgroundColor="Transparent"
                                TextColor="{StaticResource Gray600}"
                                FontSize="18"
                                Clicked="OnCancelAddProductClicked"/>
                    </Grid>

                    <Label Text="Nama Produk" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                    <Entry x:Name="AddNameEntry" Placeholder="Contoh: Indomie Goreng" BackgroundColor="{StaticResource Gray100}" />

                    <Label Text="Kategori" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                    <Entry x:Name="AddCategoryEntry" Placeholder="makanan/minuman/sembako" BackgroundColor="{StaticResource Gray100}" />

                    <Label Text="Barcode (opsional)" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                    <Entry x:Name="AddBarcodeEntry" Placeholder="899..." BackgroundColor="{StaticResource Gray100}" />

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <StackLayout Spacing="6">
                            <Label Text="Satuan" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                            <Entry x:Name="AddUnitEntry" Placeholder="pcs/btl/pak" BackgroundColor="{StaticResource Gray100}" />
                        </StackLayout>
                        <StackLayout Grid.Column="1" Spacing="6">
                            <Label Text="Stok Awal" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                            <Entry x:Name="AddInitialStockEntry" Placeholder="0" Keyboard="Numeric" BackgroundColor="{StaticResource Gray100}" />
                        </StackLayout>
                    </Grid>

                    <Grid ColumnDefinitions="*,*" ColumnSpacing="10">
                        <StackLayout Spacing="6">
                            <Label Text="Harga Jual (Rp)" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                            <Entry x:Name="AddSellPriceEntry" Placeholder="0" Keyboard="Numeric" BackgroundColor="{StaticResource Gray100}" />
                        </StackLayout>
                        <StackLayout Grid.Column="1" Spacing="6">
                            <Label Text="Harga Modal (Rp)" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                            <Entry x:Name="AddCostPriceEntry" Placeholder="0" Keyboard="Numeric" BackgroundColor="{StaticResource Gray100}" />
                        </StackLayout>
                    </Grid>

                    <Label Text="Kadaluarsa Batch Stok Awal" FontAttributes="Bold" TextColor="{StaticResource Gray900}"/>
                    <DatePicker x:Name="AddExpiryDatePicker" BackgroundColor="{StaticResource Gray200}" TextColor="{StaticResource Gray900}" />

                    <Button Text="Simpan Produk"
                            BackgroundColor="{StaticResource Primary}"
                            TextColor="White"
                            CornerRadius="10"
                            HeightRequest="48"
                            Clicked="OnSaveAddProductClicked" />
                </StackLayout>
            </Frame>
        </Grid>
        
        <!-- Header with Search and Add Button -->
        <Frame Grid.Row="0" 
               BackgroundColor="White" 
               CornerRadius="0" 
               Padding="20" 
               HasShadow="True" 
               Margin="0,0,0,10">
            
            <Grid ColumnDefinitions="*,Auto,Auto,Auto" ColumnSpacing="10">
                
                <!-- Search Bar -->
                <Frame Grid.Column="0" 
                       BackgroundColor="{StaticResource Gray100}" 
                       CornerRadius="10" 
                       Padding="0" 
                       HasShadow="False">
                    <Grid ColumnDefinitions="Auto,*,Auto">
                        <Label Grid.Column="0" 
                               Text="ðŸ”" 
                               FontSize="18" 
                               VerticalOptions="Center" 
                               Margin="15,0,5,0"/>
                        <Entry Grid.Column="1" 
                               x:Name="SearchEntry" 
                               Placeholder="Cari produk..." 
                               BackgroundColor="Transparent" 
                               TextChanged="OnSearchTextChanged"/>
                        <Button Grid.Column="2" 
                                Text="âœ•" 
                                BackgroundColor="Transparent" 
                                TextColor="{StaticResource Gray600}" 
                                FontSize="16" 
                                Clicked="OnClearSearchClicked" 
                                IsVisible="False" 
                                x:Name="ClearSearchButton"/>
                    </Grid>
                </Frame>
                
                <!-- Add Product Button -->
                <Button Grid.Column="1" 
                        Text="+ Tambah" 
                        BackgroundColor="{StaticResource Primary}" 
                        TextColor="White" 
                        CornerRadius="10" 
                        HeightRequest="50" 
                        WidthRequest="100" 
                        FontAttributes="Bold" 
                        Clicked="OnAddProductClicked"/>

                <!-- Export PDF (Stok) -->
                <Button Grid.Column="2"
                        Text="ðŸ“„ PDF"
                        BackgroundColor="{StaticResource Gray100}"
                        TextColor="{StaticResource TextPrimary}"
                        BorderColor="{StaticResource Gray300}"
                        BorderWidth="1"
                        CornerRadius="10"
                        HeightRequest="50"
                        WidthRequest="90"
                        FontAttributes="Bold"
                        Clicked="OnExportStockPdfClicked" />

                <!-- Export Excel (Stok) -->
                <Button Grid.Column="3"
                        Text="ðŸ“Š Excel"
                        BackgroundColor="{StaticResource Gray100}"
                        TextColor="{StaticResource TextPrimary}"
                        BorderColor="{StaticResource Gray300}"
                        BorderWidth="1"
                        CornerRadius="10"
                        HeightRequest="50"
                        WidthRequest="90"
                        FontAttributes="Bold"
                        Clicked="OnExportStockExcelClicked" />
                
            </Grid>
            
        </Frame>
        
        <!-- Stock List -->
        <ScrollView Grid.Row="1" Padding="20,0">
            <StackLayout x:Name="StockContainer" Spacing="15" />
        </ScrollView>
        
    </Grid>
    
</ContentPage>